<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Dashboard</title>
    <style>
        :root {
            --primary: #4CAF50; --bg: #f4f7f6; --card: #ffffff;
            --text-dark: #333; --text-muted: #666; --warning: #ff9800;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg); margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .dashboard {
            width: 100%; max-width: 450px;
            display: flex; flex-direction: column; gap: 20px;
        }

        .card {
            background: var(--card); padding: 20px;
            border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        h2 { margin: 0 0 15px 0; color: var(--text-dark); font-size: 20px; display: flex; align-items: center; gap: 8px;}
        .subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 15px; }

        /* Zona Kemarin */
        .missed-list { list-style: none; padding: 0; margin: 0; color: var(--warning); font-weight: bold;}
        .missed-list li { padding: 8px 0; border-bottom: 1px dashed #eee; display: flex; align-items: center; gap: 8px;}
        .missed-list li::before { content: "‚ö†Ô∏è"; }
        .missed-list li:last-child { border-bottom: none; }
        .empty-state { color: var(--primary); font-style: italic; font-size: 14px;}

        /* Zona Hari Ini */
        .progress-bar { height: 8px; background: #eee; border-radius: 4px; margin-bottom: 20px; overflow: hidden;}
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        
        .habit-list { list-style: none; padding: 0; margin: 0; }
        .habit-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .habit-info { display: flex; align-items: center; gap: 12px; }
        input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); }
        .action-btns button { background: none; border: none; cursor: pointer; opacity: 0.5; }
        .action-btns button:hover { opacity: 1; }

        .add-habit { display: flex; gap: 10px; margin-top: 15px; }
        .add-habit input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        .add-habit button { background: var(--primary); color: white; border: none; border-radius: 6px; padding: 8px 15px; cursor: pointer; }

        /* Agenda Besok */
        .agenda-input { display: flex; flex-direction: column; gap: 10px; }
        .agenda-input textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: vertical; min-height: 60px; font-family: inherit; box-sizing: border-box;}
        .btn-agenda { background: #2196F3; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold;}

        /* Tombol Simpan Utama */
        .btn-sync { background: var(--text-dark); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; text-align: center; margin-top: 10px; transition: 0.3s;}
        .btn-sync:hover { background: #000; }
        
        /* Loading Overlay */
        #loading { display: none; text-align: center; padding: 10px; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="dashboard">

    <div id="loading">Memuat data dari server... ‚è≥</div>

    <div class="card">
        <h2>‚è™ Evaluasi Kemarin</h2>
        <div class="subtitle" id="dateYesterday"></div>
        <ul class="missed-list" id="missedList">
            </ul>
    </div>

    <div class="card">
        <h2>üéØ Fokus Hari Ini</h2>
        <div class="subtitle" id="dateToday"></div>
        
        <div id="todayAgendaContainer" style="display:none; background: #e3f2fd; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
            <strong style="color: #1976d2; font-size: 14px;">Agenda Khusus Hari Ini:</strong>
            <ul id="todayAgendaList" style="margin: 5px 0 0; padding-left: 20px; font-size: 14px; color: #333;"></ul>
        </div>

        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        
        <ul class="habit-list" id="habitList"></ul>

        <div class="add-habit">
            <input type="text" id="newHabitInput" placeholder="Tambah rutinitas...">
            <button onclick="addHabit()">+</button>
        </div>
    </div>

    <div class="card">
        <h2>‚è© Catatan & Agenda Besok</h2>
        <div class="agenda-input">
            <textarea id="agendaTomorrow" placeholder="Tulis apa yang harus dilakukan besok..."></textarea>
            <button class="btn-agenda" onclick="saveAgenda()">Simpan Agenda Besok</button>
        </div>
    </div>

    <button class="btn-sync" id="btnSync" onclick="saveToday()">Simpan Rekap Hari Ini ke Database</button>

</div>

<script>
    // ======================================================================
    // PASTE URL APPS SCRIPT ANDA DI BAWAH INI:
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzxmna0szVmBrWhMmznXkuq519TRzahIJDzBhrmEnM5b6g0GOEuzzuwmRpP5z_ndSb5UQ/exec"; 
    // ======================================================================

    // Set Tanggal Tampilan
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const today = new Date();
    const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);
    
    document.getElementById('dateToday').innerText = today.toLocaleDateString('id-ID', options);
    document.getElementById('dateYesterday').innerText = yesterday.toLocaleDateString('id-ID', options);

    // Data Habit Lokal
    let habits = JSON.parse(localStorage.getItem('myHabits')) || [
        { name: "Bangun Pagi", status: false },
        { name: "Cek Data Center", status: false }
    ];

    const habitListEl = document.getElementById('habitList');
    const progressFillEl = document.getElementById('progressFill');

    function saveAndRender() {
        localStorage.setItem('myHabits', JSON.stringify(habits));
        renderHabits();
    }

    function renderHabits() {
        habitListEl.innerHTML = '';
        let completed = 0;
        habits.forEach((h, i) => {
            if (h.status) completed++;
            habitListEl.innerHTML += `
                <li class="habit-item">
                    <div class="habit-info">
                        <input type="checkbox" onchange="toggleHabit(${i})" ${h.status ? 'checked' : ''}>
                        <span>${h.name}</span>
                    </div>
                    <div class="action-btns">
                        <button onclick="deleteHabit(${i})">üóëÔ∏è</button>
                    </div>
                </li>
            `;
        });
        progressFillEl.style.width = habits.length ? (completed / habits.length) * 100 + '%' : '0%';
    }

    function toggleHabit(i) { habits[i].status = !habits[i].status; saveAndRender(); }
    function addHabit() {
        const val = document.getElementById('newHabitInput').value.trim();
        if (val) { habits.push({ name: val, status: false }); document.getElementById('newHabitInput').value = ""; saveAndRender(); }
    }
    function deleteHabit(i) {
        if(confirm("Hapus tugas ini?")) { habits.splice(i, 1); saveAndRender(); }
    }

    // MENGAMBIL DATA DARI SERVER SAAT DIBUKA
    function fetchServerData() {
        if(SCRIPT_URL.includes("PASTE_URL")) return; // Abaikan jika URL belum diganti
        
        document.getElementById('loading').style.display = 'block';
        
        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                // Tampilkan tugas kemarin yang terlewat
                const missedUl = document.getElementById('missedList');
                if (data.kemarinBelumSelesai && data.kemarinBelumSelesai.length > 0) {
                    missedUl.innerHTML = data.kemarinBelumSelesai.map(task => `<li>${task} (Belum selesai)</li>`).join('');
                } else {
                    missedUl.innerHTML = '<div class="empty-state">Luar biasa! Kemarin semua tugas selesai. üéâ</div>';
                }

                // Tampilkan agenda khusus untuk hari ini
                const agendaContainer = document.getElementById('todayAgendaContainer');
                const agendaUl = document.getElementById('todayAgendaList');
                if (data.agendaHariIni && data.agendaHariIni.length > 0) {
                    agendaContainer.style.display = 'block';
                    agendaUl.innerHTML = data.agendaHariIni.map(task => `<li>${task}</li>`).join('');
                }
            })
            .catch(err => {
                document.getElementById('loading').innerText = 'Gagal memuat data server.';
                console.error(err);
            });
    }

    // MENYIMPAN REKAP HARI INI
    function saveToday() {
        const btn = document.getElementById('btnSync');
        btn.innerText = "Menyimpan...";
        
        const payload = {
            action: "saveToday",
            data: habits
        };

        fetch(SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            alert("Rekap hari ini masuk Database!");
            btn.innerText = "Tersimpan ‚úì";
            btn.style.background = "#4CAF50";
            setTimeout(() => { btn.innerText = "Simpan Rekap Hari Ini ke Database"; btn.style.background = "var(--text-dark)"; }, 3000);
            
            // Opsional: Reset centang untuk besok
            if(confirm("Apakah Anda ingin mereset semua centang untuk persiapan besok?")) {
                habits.forEach(h => h.status = false);
                saveAndRender();
            }
        });
    }

    // MENYIMPAN AGENDA BESOK
    function saveAgenda() {
        const text = document.getElementById('agendaTomorrow').value.trim();
        if(!text) { alert("Isi agenda dulu!"); return; }
        
        const payload = { action: "saveTomorrow", agenda: text };

        fetch(SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).then(() => {
            alert("Agenda untuk besok berhasil dicatat!");
            document.getElementById('agendaTomorrow').value = "";
        });
    }

    renderHabits();
    fetchServerData(); // Panggil data dari server saat web dimuat

</script>

</body>
</html>